<!DOCTYPE html>
<html lang="pt-BR">
<head>
 <meta charset="UTF-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
 <link rel="icon" href="/favicon.ico" type="image/x-icon">
 <title>Meu Perfil - Guilda do Poker</title>
 <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
 <style>
 :root{
 --bg:#121212;
 --bg-2:#1c1c1c;
 --bg-3:#2c2c2c;
 --gold:#ffcc00;
 --text:#f5f5f5;
 }



 *{box-sizing:border-box;margin:0;padding:0}



 body{
 font-family: Arial, sans-serif;
 background-color: var(--bg);
 color: var(--text);
 line-height: 1.6;
 }



 header{
 background: var(--bg-2);
 padding: 20px;
 text-align: center;
 border-bottom: 2px solid var(--gold);
 position: relative;
 min-height: 80px;
 }



 nav{
 background: var(--bg-3);
 padding: 10px;
 text-align: center;
 position: relative;
 }



 .nav-container {
 max-width: 1000px;
 margin: 0 auto;
 display: flex;
 justify-content: center;
 position: relative;
 }



 .menu {
 display: flex;
 flex-wrap: wrap;
 justify-content: center;
 list-style: none;
 }



 .menu li {
 margin: 0;
 }



 nav a{
 color: var(--gold);
 margin: 0 15px;
 text-decoration: none;
 font-weight: bold;
 transition: .2s;
 display: block;
 padding: 10px 0;
 }
 nav a:hover, nav a.active{ color:#ffffff; text-decoration: underline; }



 /* Menu Mobile */
 .menu-toggle {
 display: none;
 flex-direction: column;
 justify-content: space-around;
 width: 42px;
 height: 36px;
 background: transparent;
 border: none;
 cursor: pointer;
 padding: 0;
 position: absolute;
 right: 25px;
 top: 20px;
 z-index: 1001;
 }



 .menu-toggle span {
 width: 100%;
 height: 4px;
 background-color: var(--gold);
 border-radius: 3px;
 transition: all 0.3s linear;
 }



 .menu-toggle.active span:nth-child(1) {
 transform: rotate(45deg) translate(8px, 8px);
 }



 .menu-toggle.active span:nth-child(2) {
 opacity: 0;
 }



 .menu-toggle.active span:nth-child(3) {
 transform: rotate(-45deg) translate(7px, -7px);
 }



 main{
 max-width: 1000px;
 margin: 40px auto;
 padding: 0 20px;
 }



 /* Estilos específicos do perfil */
 .profile-header {
 display: flex;
 flex-direction: column;
 align-items: center;
 margin-bottom: 30px;
 text-align: center;
 }



 .profile-picture {
 width: 120px;
 height: 120px;
 border-radius: 50%;
 background-color: var(--bg-2);
 display: flex;
 align-items: center;
 justify-content: center;
 margin-bottom: 20px;
 overflow: hidden;
 border: 3px solid var(--gold);
 cursor: pointer;
 position: relative;
 }



 .profile-picture img {
 width: 100%;
 height: 100%;
 object-fit: cover;
 }



 .profile-picture:hover .upload-overlay {
 opacity: 1;
 }



 .upload-overlay {
 position: absolute;
 top: 0;
 left: 0;
 right: 0;
 bottom: 0;
 background: rgba(0, 0, 0, 0.7);
 display: flex;
 align-items: center;
 justify-content: center;
 opacity: 0;
 transition: opacity 0.3s;
 color: var(--gold);
 font-weight: bold;
 }



 .profile-info h1 {
 color: var(--gold);
 margin-bottom: 10px;
 font-size: 24px;
 }



 .profile-info .poker-nickname {
 color: #ffcc00;
 font-size: 18px;
 font-weight: bold;
 margin-bottom: 10px;
 font-style: italic;
 }



 .profile-info p {
 color: #e6e6e6;
 margin-bottom: 5px;
 }



 .profile-content {
 display: flex;
 justify-content: center;
 }



 .info-section {
 background: var(--bg-2);
 padding: 25px;
 border-radius: 10px;
 box-shadow: 0 0 10px #000;
 width: 100%;
 max-width: 600px;
 }



 .info-section h2 {
 color: var(--gold);
 margin-bottom: 20px;
 padding-bottom: 10px;
 border-bottom: 1px solid var(--bg-3);
 text-align: center;
 }



 .form-group {
 margin-bottom: 20px;
 }



 .form-group label {
 display: block;
 margin-bottom: 8px;
 color: var(--gold);
 font-weight: bold;
 }



 .form-group input,
 .form-group select {
 width: 100%;
 padding: 12px 15px;
 border: 1px solid var(--bg-3);
 border-radius: 5px;
 background-color: var(--bg-3);
 color: var(--text);
 font-size: 16px;
 }



 .form-group input:disabled,
 .form-group select:disabled {
 opacity: 0.7;
 cursor: not-allowed;
 background-color: var(--bg-3);
 }



 .form-group input:not(:disabled),
 .form-group select:not(:disabled) {
 opacity: 1;
 cursor: text;
 background-color: var(--bg-2);
 border: 1px solid var(--gold);
 }



 .action-buttons {
 display: flex;
 gap: 15px;
 margin-top: 25px;
 flex-wrap: wrap;
 }



 .btn {
 padding: 12px 25px;
 border: none;
 border-radius: 5px;
 cursor: pointer;
 font-weight: bold;
 transition: all 0.3s ease;
 flex: 1;
 min-width: 120px;
 }



 .btn-primary {
 background-color: var(--gold);
 color: #121212;
 }



 .btn-primary:hover {
 background-color: #e6b800;
 }



 .btn-secondary {
 background-color: var(--bg-3);
 color: var(--text);
 }



 .btn-secondary:hover {
 background-color: #3a3a3a;
 }



 .btn-hidden {
 display: none !important;
 }



 .notification {
 position: fixed;
 top: 20px;
 right: 20px;
 padding: 15px 20px;
 border-radius: 5px;
 background-color: var(--bg-2);
 color: var(--text);
 box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
 z-index: 10000;
 display: flex;
 align-items: center;
 gap: 10px;
 transform: translateX(100%);
 transition: transform 0.3s ease;
 }



 .notification.show {
 transform: translateX(0);
 }



 .notification.success {
 border-left: 4px solid #4caf50;
 }



 .notification.error {
 border-left: 4px solid #f44336;
 }



 .notification-icon {
 font-size: 20px;
 }



 footer{
 text-align:center;
 padding:20px;
 background: var(--bg-2);
 margin-top:40px;
 border-top: 2px solid var(--gold);
 font-size:14px;
 color:#bbb;
 }
 footer div{
 display:flex;
 justify-content:center;
 flex-wrap:wrap;
 gap:10px;
 margin-top:10px;
 }
 footer img{ max-height:40px; height:auto; }



 .aviso18{
 display:flex;
 align-items:center;
 justify-content:center;
 gap:10px;
 margin-top:10px;
 }
 .icone18{
 background:red;
 color:white;
 font-weight:bold;
 font-size:14px;
 padding:4px 8px;
 border-radius:5px;
 }
 .aviso18 p{ margin:0; color:#ccc; }



 /* Media Queries para Responsividade */
 @media (max-width: 768px) {
 header {
 justify-content: center;
 padding: 15px;
 position: relative;
 }


 nav {
 padding: 0;
 background: transparent;
 }


 .menu-toggle {
 display: flex;
 width: 40px;
 height: 34px;
 right: 20px;
 top: 20px;
 }



 .menu {
 display: none;
 flex-direction: column;
 width: 100%;
 position: absolute;
 top: 100%;
 left: 0;
 background-color: var(--bg-3);
 z-index: 1000;
 box-shadow: 0 5px 15px rgba(0,0,0,0.5);
 padding: 15px 0;
 border-top: 2px solid var(--gold);
 }



 .menu.active {
 display: flex;
 }



 .menu li {
 width: 100%;
 text-align: center;
 }



 nav a {
 margin: 0;
 padding: 16px;
 border-bottom: 1px solid rgba(255,255,255,0.1);
 font-size: 1.1rem;
 }


 nav a:last-child {
 border-bottom: none;
 }


 .nav-container {
 padding: 0;
 justify-content: flex-start;
 }


 .action-buttons {
 flex-direction: column;
 }


 .btn {
 width: 100%;
 }


 .info-section {
 padding: 20px 15px;
 }
 }


.avatar-option {
 width: 80px;
 height: 80px;
 border-radius: 50%;
 overflow: hidden;
 cursor: pointer;
 border: 2px solid var(--bg-3);
 transition: all 0.3s ease;
}


.avatar-option:hover {
 transform: scale(1.05);
 border-color: var(--gold);
}


.avatar-option.selected {
 border: 3px solid var(--gold);
 transform: scale(1.05);
}


.avatar-option img {
 width: 100%;
 height: 100%;
 object-fit: cover;
}

/* Estilos do Modal de Avatar */
.avatar-modal {
  display: none;
  position: fixed;
  z-index: 10000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.8);
}

.modal-content {
  background-color: var(--bg-2);
  margin: 5% auto;
  padding: 20px;
  border-radius: 10px;
  width: 90%;
  max-width: 600px;
  max-height: 80vh;
  overflow-y: auto;
  position: relative;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 1px solid var(--bg-3);
}

.modal-header h2 {
  color: var(--gold);
  margin: 0;
}

.close-modal {
  color: var(--text);
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
}

.close-modal:hover {
  color: var(--gold);
}

.modal-body {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 15px;
}

 </style>
</head>
<body>



 <header>
 <button class="menu-toggle" aria-label="Abrir menu">
 <span></span>
 <span></span>
 <span></span>
 </button>
 </header>



 <nav>
 <div class="nav-container">
 <ul class="menu">
 <li><a href="index.html">Home</a></li>
 <li><a href="pppoker.html">PPPoker</a></li>
 <li><a href="suprema.html">Suprema Poker</a></li>
 <li><a href="torneios.html">Torneios</a></li>
 <li><a href="regrasdopoker.html">Regras do Poker</a></li>
 <li><a href="divulgacao.html">Divulgação</a></li>
 <li><a href="dicionario.html">Dicionário</a></li>
 <li><a href="blog.html">Blog</a></li>
 <li><a href="contato.html">Contato</a></li>
 </ul>
 </div>
 </nav>



 <main>
 <div class="profile-header">
 <div class="profile-picture" id="upload-foto">
 <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIiB2aWV3Qm94PSIwIDAgMTIwIDEyMCI+PHJlY3Qgd2lkdGg9IjEyMCIgaGVpZ2h0PSIxMjAiIGZpbGw9IiMxYzRjMjkiLz48dGV4dCB4PSI2MCIgeT0iNjUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSI0MCIgZmlsbD0iI2M4YjY1MyIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+8J+SujwvdGV4dD48L3N2Zz4=" alt="Foto de perfil">
 <div class="upload-overlay">Alterar Foto</div>
 </div>
 <div class="profile-info">
 <h1 id="user-name">Usuário</h1>
 <div id="user-poker-nickname" class="poker-nickname"></div>
 <p id="user-email">usuario@exemplo.com</p>
 <p>Membro desde: <span id="member-since">01/01/2023</span></p>
 </div>
 </div>



 <div class="profile-content">
 <div class="info-section">
 <h2>Informações Pessoais</h2>
 <form id="profile-form">
 <div class="form-group">
 <label for="nome_completo">Nome Completo</label>
 <input type="text" id="nome_completo" name="nome_completo" disabled>
 </div>

 <div class="form-group">
 <label for="telefone">Telefone</label>
 <input type="tel" id="telefone" name="telefone" disabled>
 </div>

 <div class="form-group">
 <label for="apelido_poker">Apelido no Poker</label>
 <input type="text" id="apelido_poker" name="apelido_poker" disabled>
 </div>

<!-- Modal de seleção de avatares -->
<div id="avatar-modal" class="avatar-modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Selecionar Avatar</h2>
      <span class="close-modal">&times;</span>
    </div>
    <div class="modal-body">
      <div class="avatar-options" id="avatar-options-modal">
        <!-- Os avatares serão carregados aqui -->
      </div>
    </div>
  </div>
</div>

 <div class="form-group">
 <label for="plataforma_preferida">Plataforma Preferida</label>
 <select id="plataforma_preferida" name="plataforma_preferida" disabled>
 <option value="">Selecione uma plataforma</option>
 <option value="PPPoker">PPPoker</option>
 <option value="Suprema Poker">Suprema Poker</option>
 <option value="Outras">Outras</option>
 </select>
 </div>

 <div class="action-buttons">
 <button type="button" id="btn-editar" class="btn btn-primary">Editar Perfil</button>
 <button type="button" id="btn-salvar" class="btn btn-primary btn-hidden">Salvar</button>
 <button type="button" id="btn-cancelar" class="btn btn-secondary btn-hidden">Cancelar</button>
 </div>
 </form>
 </div>
 </div>
 </main>



 <div id="notification" class="notification">
 <span class="notification-icon"></span>
 <span id="notification-message"></span>
 </div>



 <footer>
 <p>&copy; 2025 Guilda do Poker - Todos os direitos reservados</p>
 <div>
 <img src="logoguildapoker.png" alt="Logo Guilda do Poker">
 <img src="logopppoker.png" alt="Logo PPPoker">
 <img src="logosupremapoker.png" alt="Logo Suprema Poker">
 <img src="logocaveirapoker.png" alt="Logo Caveira Poker">
 </div>
 <div class="aviso18">
 <span class="icone18">18+</span>
 <p>Proibido para menores de 18 anos. Jogue com responsabilidade.</p>
 </div>
 <div style="margin-top: 15px; text-align: center;">
 <a href="politica.html" style="color: #bbb; text-decoration: underline; margin: 0 10px;">Política de Privacidade</a>
 <span style="color: #666;">|</span>
 <a href="termos.html" style="color: #bbb; text-decoration: underline; margin: 0 10px;">Termos e Condições</a>
 </div>
 </footer>

 <script>

 // Configuração do Supabase
 const supabaseUrl = 'https://ffyectkjlwgqzjgwhexy.supabase.co';
 const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhbmFzZSIsInJlZiI6ImZmeWVjdGtqbHdncXpqZ3doZXh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYzMTAxNDAsImV4cCI6MjA3MTg4NjE0MH0.bWxnDQaJ6wILzK09TZ9B9ZdUdqVS7bukabBwZDmyvrE';
 const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

 // Elementos DOM
 const userNameElement = document.getElementById('user-name');
 const userEmailElement = document.getElementById('user-email');
 const userPokerNicknameElement = document.getElementById('user-poker-nickname');
 const memberSinceElement = document.getElementById('member-since');
 const nomeCompletoInput = document.getElementById('nome_completo');
 const telefoneInput = document.getElementById('telefone');
 const apelidoPokerInput = document.getElementById('apelido_poker');
 const plataformaSelect = document.getElementById('plataforma_preferida');
 const uploadFoto = document.getElementById('upload-foto');

 const btnEditar = document.getElementById('btn-editar');
 const btnSalvar = document.getElementById('btn-salvar');
 const btnCancelar = document.getElementById('btn-cancelar');

 const notification = document.getElementById('notification');
 const notificationMessage = document.getElementById('notification-message');

 // Estado de edição
 let editMode = false;
 let originalValues = {};
 let currentAvatarId = null;

 // Função para mostrar notificações
 function showNotification(message, isSuccess = true) {
   notificationMessage.textContent = message;
   notification.className = isSuccess ? 'notification success' : 'notification error';
   notification.classList.add('show');

   setTimeout(() => {
     notification.classList.remove('show');
   }, 3000);
 }

 // Adicionar evento para fechar o modal
 document.querySelector('.close-modal').addEventListener('click', function() {
   document.getElementById('avatar-modal').style.display = 'none';
 });

 // Fechar o modal ao clicar fora dele
 window.addEventListener('click', function(event) {
   const modal = document.getElementById('avatar-modal');
   if (event.target === modal) {
     modal.style.display = 'none';
   }
 });

 // Menu mobile toggle
 const menuToggle = document.querySelector('.menu-toggle');
 const menu = document.querySelector('.menu');

 menuToggle.addEventListener('click', function(e) {
   e.stopPropagation();
   menu.classList.toggle('active');
   menuToggle.classList.toggle('active');
 });

 // Fechar menu ao clicar em um link (em dispositivos móveis)
 const menuLinks = document.querySelectorAll('.menu a');
 menuLinks.forEach(link => {
   link.addEventListener('click', function() {
     if (window.innerWidth <= 768) {
       menu.classList.remove('active');
       menuToggle.classList.remove('active');
     }
   });
 });

 // Fechar o menu ao clicar fora dele
 document.addEventListener('click', function(event) {
   if (window.innerWidth <= 768 && menu.classList.contains('active')) {
     if (!menu.contains(event.target) && !menuToggle.contains(event.target)) {
       menu.classList.remove('active');
       menuToggle.classList.remove('active');
     }
   }
 });

 // Verificar estado de autenticação
 async function checkAuthState() {
   try {
     const { data: { session } } = await supabase.auth.getSession();
     console.log('Sessão do usuário:', session);

     if (!session) {
       console.log('Usuário não autenticado, redirecionando para index.html');
       window.location.href = 'index.html';
       return;
     }

     // Carregar dados do usuário
     await loadUserData(session.user);
   } catch (error) {
     console.error('Erro ao verificar estado de autenticação:', error);
     showNotification('Erro de conexão. Tente novamente.', false);
   }
 }

 // Criar perfil de usuário se não existir
 async function createUserProfile(user) {
   try {
     console.log('Criando novo perfil para:', user.id);
     const { error } = await supabase
       .from('perfis')
       .insert([
         {
           id: user.id,
           nome_completo: user.user_metadata.full_name || '',
           email: user.email,
           data_criacao: new Date().toISOString()
         }
       ]);

     if (error) {
       console.error('Erro ao criar perfil:', error);
       throw error;
     }
     console.log('Perfil criado com sucesso');
   } catch (error) {
     console.error('Erro inesperado ao criar perfil:', error);
     throw error;
   }
 }

 // Carregar dados do usuário
 async function loadUserData(user) {
   try {
     console.log('Carregando dados do usuário:', user.id);
     
     // Primeiro verifica se a tabela perfis existe e tem dados
     const { data: perfisData, error: perfisError } = await supabase
       .from('perfis')
       .select('*')
       .eq('id', user.id)
       .single();

     console.log('Dados do perfil:', perfisData);
     console.log('Erro do perfil:', perfisError);

     if (perfisError && perfisError.code === 'PGRST116') {
       console.log('Perfil não encontrado, criando novo...');
       await createUserProfile(user);
       // Recarregar dados após criar
       await loadUserData(user);
       return;
     } else if (perfisError) {
       console.error('Erro ao carregar perfil:', perfisError);
       showNotification('Erro ao carregar dados do perfil.', false);
       return;
     }

     // Agora busca os dados completos com join
     const { data, error } = await supabase
       .from('perfis')
       .select(`
         *,
         avatares (url_imagem)
       `)
       .eq('id', user.id)
       .single();

     if (error) {
       console.error('Erro ao carregar perfil com join:', error);
       // Se der erro no join, usa os dados básicos já obtidos
      if (perfisData) {
        data = perfisData;
      } else {
        throw error;
      }
     }

     console.log('Dados completos do usuário:', data);

     // Preencher dados do usuário
     userNameElement.textContent = data.nome_completo || user.user_metadata.full_name || 'Usuário';
     userEmailElement.textContent = user.email;

     // Exibir apelido do poker se existir
     if (data.apelido_poker) {
       userPokerNicknameElement.textContent = '"' + data.apelido_poker + '"';
     } else {
       userPokerNicknameElement.textContent = '';
     }

     // Formatar data de criação
     const createdDate = new Date(user.created_at);
     memberSinceElement.textContent = createdDate.toLocaleDateString('pt-BR');

     // Preencher formulário
     nomeCompletoInput.value = data.nome_completo || '';
     telefoneInput.value = data.telefone || '';
     apelidoPokerInput.value = data.apelido_poker || '';
     plataformaSelect.value = data.plataforma_preferida || '';

     // Salvar avatar atual
     currentAvatarId = data.avatar_id || null;
     console.log('Avatar ID atual:', currentAvatarId);

     // Carregar foto de perfil
     if (data.avatares && data.avatares.url_imagem) {
       console.log('Carregando avatar do relacionamento:', data.avatares.url_imagem);
       const img = uploadFoto.querySelector('img');
       img.src = data.avatares.url_imagem;
     } else if (data.url_avatar) {
       console.log('Carregando avatar URL antigo:', data.url_avatar);
       const img = uploadFoto.querySelector('img');
       img.src = data.url_avatar;
     }

     // Salvar valores originais
     originalValues = {
       nome_completo: nomeCompletoInput.value,
       telefone: telefoneInput.value,
       apelido_poker: apelidoPokerInput.value,
       plataforma_preferida: plataformaSelect.value,
       avatar_id: currentAvatarId
     };

     console.log('Valores originais salvos:', originalValues);

     // Carregar avatares
     await loadAvatares();
     
   } catch (error) {
     console.error('Erro ao carregar dados do usuário:', error);
     showNotification('Erro ao carregar dados. Tente recarregar a página.', false);
   }
 }
 
 // Atualizar perfil do usuário
 async function updateUserProfile() {
   try {
     const { data: { session } } = await supabase.auth.getSession();
     if (!session) {
       showNotification('Sessão expirada. Faça login novamente.', false);
       window.location.href = 'index.html';
       return false;
     }

     if (!nomeCompletoInput.value.trim()) {
       showNotification('Por favor, informe seu nome completo.', false);
       nomeCompletoInput.focus();
       return false;
     }

     // Obter o avatar selecionado
     const selectedAvatar = document.querySelector('.avatar-option.selected');
     const avatarId = selectedAvatar ? selectedAvatar.dataset.id : null;

     const updates = {
       nome_completo: nomeCompletoInput.value.trim(),
       telefone: telefoneInput.value.trim(),
       apelido_poker: apelidoPokerInput.value.trim(),
       plataforma_preferida: plataformaSelect.value,
       avatar_id: avatarId,
       data_atualizacao: new Date().toISOString()
     };

     const { error } = await supabase
       .from('perfis')
       .update(updates)
       .eq('id', session.user.id);

     if (error) {
       console.error('Erro ao atualizar perfil:', error);
       showNotification('Erro ao salvar alterações.', false);
       return false;
     } else {
       showNotification('Perfil atualizado com sucesso!', true);
       
       userNameElement.textContent = nomeCompletoInput.value;
       
       if (apelidoPokerInput.value) {
         userPokerNicknameElement.textContent = '"' + apelidoPokerInput.value + '"';
       } else {
         userPokerNicknameElement.textContent = '';
       }
       
       if (avatarId) {
         updateAvatarDisplay(avatarId);
       }
       
       originalValues = { ...updates };
       currentAvatarId = avatarId;
       
       return true;
     }
   } catch (error) {
     console.error('Erro inesperado ao atualizar perfil:', error);
     showNotification('Erro inesperado. Tente novamente.', false);
     return false;
   }
 }

 // Logout
 async function logout() {
   try {
     await supabase.auth.signOut();
     window.location.href = 'index.html';
   } catch (error) {
     console.error('Erro ao fazer logout:', error);
     window.location.href = 'index.html';
   }
 }

 // Event Listeners para os botões do perfil
 btnEditar.addEventListener('click', () => {
   editMode = true;
   nomeCompletoInput.disabled = false;
   telefoneInput.disabled = false;
   apelidoPokerInput.disabled = false;
   plataformaSelect.disabled = false;

   btnEditar.classList.add('btn-hidden');
   btnSalvar.classList.remove('btn-hidden');
   btnCancelar.classList.remove('btn-hidden');
 });

 btnCancelar.addEventListener('click', () => {
   editMode = false;
   nomeCompletoInput.disabled = true;
   telefoneInput.disabled = true;
   apelidoPokerInput.disabled = true;
   plataformaSelect.disabled = true;
   nomeCompletoInput.value = originalValues.nome_completo;
   telefoneInput.value = originalValues.telefone;
   apelidoPokerInput.value = originalValues.apelido_poker;
   plataformaSelect.value = originalValues.plataforma_preferida;
   
   document.querySelectorAll('.avatar-option').forEach(option => {
     option.classList.remove('selected');
   });
   
   if (originalValues.avatar_id) {
     const originalAvatar = document.querySelector(`.avatar-option[data-id="${originalValues.avatar_id}"]`);
     if (originalAvatar) {
       originalAvatar.classList.add('selected');
     }
   }
   
   btnEditar.classList.remove('btn-hidden');  
   btnSalvar.classList.add('btn-hidden');  
   btnCancelar.classList.add('btn-hidden');  
 });

 btnSalvar.addEventListener('click', async () => {
   const success = await updateUserProfile();
   if (success) {
     editMode = false;
     nomeCompletoInput.disabled = true;
     telefoneInput.disabled = true;
     apelidoPokerInput.disabled = true;
     plataformaSelect.disabled = true;

     btnEditar.classList.remove('btn-hidden');
     btnSalvar.classList.add('btn-hidden');
     btnCancelar.classList.add('btn-hidden');
   }
 });

 uploadFoto.addEventListener('click', () => {
  document.getElementById('avatar-modal').style.display = 'block';
  if (document.getElementById('avatar-options-modal').children.length === 0) {
    loadAvatares();
  }
});

 // Inicialização
 document.addEventListener('DOMContentLoaded', function() {
   console.log('Página carregada, iniciando verificação de autenticação...');
   checkAuthState();
 });

 // Monitorar mudanças de autenticação
 supabase.auth.onAuthStateChange((event, session) => {
   console.log('Mudança de estado de autenticação:', event);
   checkAuthState();
 });

 // Carregar avatares disponíveis
 async function loadAvatares() {
   try {
     console.log('Carregando avatares...');
     const { data, error } = await supabase
       .from('avatares')
       .select('*')
       .eq('ativo', true)
       .order('id');

     if (error) {
       console.error('Erro ao carregar avatares:', error);
       return;
     }

     console.log('Avatares carregados:', data.length);
     displayAvatares(data);
   } catch (error) {
     console.error('Erro inesperado ao carregar avatares:', error);
   }
 }

 // Exibir avatares na interface
function displayAvatares(avatares) {
   const avatarOptions = document.getElementById('avatar-options-modal');
   avatarOptions.innerHTML = '';

   avatares.forEach(avatar => {
     const avatarElement = document.createElement('div');
     avatarElement.className = 'avatar-option';
     avatarElement.dataset.id = avatar.id;
     avatarElement.innerHTML = `<img src="${avatar.url_imagem}" alt="${avatar.nome}" title="${avatar.nome}">`;
     
     avatarElement.addEventListener('click', () => {
       selectAvatar(avatar.id);
       document.getElementById('avatar-modal').style.display = 'none';
     });
     
     avatarOptions.appendChild(avatarElement);
   });
   
   if (currentAvatarId) {
     const avatarOption = document.querySelector(`.avatar-option[data-id="${currentAvatarId}"]`);
     if (avatarOption) {
       avatarOption.classList.add('selected');
     }
   }
}

 // Selecionar um avatar
 function selectAvatar(avatarId) {
   document.querySelectorAll('.avatar-option').forEach(option => {
     option.classList.remove('selected');
   });
   
   const selectedAvatar = document.querySelector(`.avatar-option[data-id="${avatarId}"]`);
   if (selectedAvatar) {
     selectedAvatar.classList.add('selected');
   }
 }

 // Atualizar a exibição do avatar
 async function updateAvatarDisplay(avatarId) {
   try {
     const { data, error } = await supabase
       .from('avatares')
       .select('url_imagem')
       .eq('id', avatarId)
       .single();

     if (error || !data) {
       console.error('Erro ao buscar avatar:', error);
       return;
     }

     const profileImg = document.querySelector('.profile-picture img');
     profileImg.src = data.url_imagem;
   } catch (error) {
     console.error('Erro ao atualizar exibição do avatar:', error);
   }
 }
</script>
</body>
</html>

